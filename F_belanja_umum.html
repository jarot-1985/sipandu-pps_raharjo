<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Belanja Umum - SIPANDU</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Plus Jakarta Sans', system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji", "Segoe UI Emoji"; }
  </style>
</head>
<body class="bg-slate-50 text-slate-800">
  <div class="max-w-6xl mx-auto p-6 md:p-10">
    <!-- Header -->
    <div class="mb-6">
      <div class="flex items-center gap-3 mb-2">
        <div class="w-10 h-10 rounded-xl bg-indigo-600 text-white flex items-center justify-center font-black">BU</div>
        <div>
          <h1 class="text-xl md:text-2xl font-black">Pencatatan Belanja Umum</h1>
          <p class="text-[10px] md:text-xs font-black uppercase tracking-widest text-indigo-600">Input dan Riwayat</p>
        </div>
      </div>
      <p class="text-slate-500 text-sm">Form ini untuk mencatat transaksi belanja umum per unit kerja.</p>
    </div>

    <!-- Card Form -->
    <div class="bg-white rounded-[2rem] border border-slate-200 shadow-sm overflow-hidden">
      <div class="p-6 md:p-8 space-y-8">
        <h2 class="text-lg md:text-xl font-black text-slate-800">Input Belanja</h2>
        <form id="belanjaUmumForm" class="space-y-8">
          <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
            <div>
              <label for="unitKerja" class="block text-[10px] font-black text-slate-500 uppercase tracking-widest mb-2">Unit Kerja</label>
              <select id="unitKerja" name="unitKerja" class="w-full p-3.5 bg-slate-50 border border-slate-200 rounded-xl outline-none font-bold text-sm focus:border-indigo-500" required>
                <option value="">Pilih Unit...</option>
                <option value="PPSDI Raharjo Sragen">PPSDI Raharjo Sragen</option>
                <option value="RPSLU Mojomulyo Sragen">RPSLU Mojomulyo Sragen</option>
                <option value="RPSA Pamardi Siwi Sragen">RPSA Pamardi Siwi Sragen</option>
                <option value="RPS PMKS Gondang">RPS PMKS Gondang</option>
              </select>
            </div>
            <div>
              <label for="tanggalBelanja" class="block text-[10px] font-black text-slate-500 uppercase tracking-widest mb-2">Tanggal</label>
              <input id="tanggalBelanja" type="date" name="tanggalBelanja" class="w-full p-3.5 bg-slate-50 border border-slate-200 rounded-xl outline-none font-bold text-sm focus:border-indigo-500" required />
            </div>
            <div>
              <label for="penyedia" class="block text-[10px] font-black text-slate-500 uppercase tracking-widest mb-2">Penyedia</label>
              <input id="penyedia" name="penyedia" placeholder="Nama Toko / Penyedia" class="w-full p-3.5 bg-slate-50 border border-slate-200 rounded-xl outline-none font-bold text-sm focus:border-indigo-500" />
            </div>
          </div>

          <div class="space-y-2">
            <label for="uraian" class="block text-[10px] font-black text-slate-500 uppercase tracking-widest">Uraian Pekerjaan</label>
            <input id="uraian" name="uraian" placeholder="Uraian" class="w-full p-3.5 bg-slate-50 border border-slate-200 rounded-xl outline-none font-bold text-sm focus:border-indigo-500" required />
          </div>

          <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
            <div class="md:col-span-2">
              <label for="namaBarang" class="block text-[10px] font-black text-slate-500 uppercase tracking-widest mb-2">Nama Barang</label>
              <input id="namaBarang" name="namaBarang" class="w-full p-3.5 bg-slate-50 border border-slate-200 rounded-xl outline-none font-bold text-sm focus:border-indigo-500" required />
            </div>
            <div>
              <label for="merk" class="block text-[10px] font-black text-slate-500 uppercase tracking-widest mb-2">Merk</label>
              <input id="merk" name="merk" class="w-full p-3.5 bg-slate-50 border border-slate-200 rounded-xl outline-none text-sm focus:border-indigo-500" />
            </div>
            <div>
              <label for="model" class="block text-[10px] font-black text-slate-500 uppercase tracking-widest mb-2">Model</label>
              <input id="model" name="model" class="w-full p-3.5 bg-slate-50 border border-slate-200 rounded-xl outline-none text-sm focus:border-indigo-500" />
            </div>
            <div>
              <label for="ukuran" class="block text-[10px] font-black text-slate-500 uppercase tracking-widest mb-2">Ukuran</label>
              <input id="ukuran" name="ukuran" class="w-full p-3.5 bg-slate-50 border border-slate-200 rounded-xl outline-none text-sm focus:border-indigo-500" />
            </div>
            <div>
              <label for="warna" class="block text-[10px] font-black text-slate-500 uppercase tracking-widest mb-2">Warna</label>
              <input id="warna" name="warna" class="w-full p-3.5 bg-slate-50 border border-slate-200 rounded-xl outline-none text-sm focus:border-indigo-500" />
            </div>
          </div>

          <div class="grid grid-cols-1 md:grid-cols-3 gap-6 bg-indigo-50/50 p-6 rounded-3xl border border-indigo-100">
            <div>
              <label for="volume" class="block text-[10px] font-black text-indigo-500 uppercase tracking-widest mb-2">Volume</label>
              <input id="volume" type="number" name="volume" class="w-full p-3 bg-white border border-indigo-200 rounded-xl text-sm font-bold outline-none focus:border-indigo-500" required />
            </div>
            <div>
              <label for="hargaSatuan" class="block text-[10px] font-black text-indigo-500 uppercase tracking-widest mb-2">Harga Satuan</label>
              <input id="hargaSatuan" type="number" name="hargaSatuan" class="w-full p-3 bg-white border border-indigo-200 rounded-xl text-sm font-bold outline-none focus:border-indigo-500" required />
            </div>
            <div class="flex flex-col justify-end">
              <div class="p-3 bg-indigo-600 text-white rounded-xl text-center shadow-lg">
                <p class="text-[9px] font-black uppercase opacity-70">Total</p>
                <p id="totalLabel" class="text-lg font-black">Rp 0</p>
              </div>
            </div>
          </div>

          <div class="space-y-3">
            <label class="block text-[10px] font-black text-slate-500 uppercase tracking-widest">Dokumentasi (maks 4 foto)</label>
            <div id="photoGrid" class="grid grid-cols-2 md:grid-cols-4 gap-4"></div>
            <label class="aspect-square border-2 border-dashed border-slate-200 rounded-2xl flex flex-col items-center justify-center gap-2 cursor-pointer hover:bg-slate-50 transition-all text-slate-400">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" /></svg>
              <span class="text-[9px] font-black uppercase">Tambah Foto</span>
              <input id="photoInput" type="file" accept="image/*" class="hidden" multiple />
            </label>
          </div>

          <div class="space-y-2">
            <label for="keteranganLain" class="block text-[10px] font-black text-slate-500 uppercase tracking-widest">Keterangan</label>
            <input id="keteranganLain" name="keteranganLain" placeholder="Opsional" class="w-full p-3.5 bg-slate-50 border border-slate-200 rounded-xl outline-none font-bold text-sm focus:border-indigo-500" />
          </div>

          <div class="flex gap-3 pt-2">
            <button type="reset" class="px-5 py-3 bg-slate-100 text-slate-600 rounded-xl font-black text-[10px] uppercase hover:bg-slate-200">Reset</button>
            <button type="submit" class="px-6 py-3 bg-indigo-600 text-white rounded-xl font-black text-[10px] uppercase tracking-widest hover:bg-indigo-700">Simpan</button>
          </div>
        </form>
      </div>
    </div>

    <!-- Riwayat (dummy lokal) -->
    <div class="mt-6 bg-white rounded-3xl border border-slate-200 shadow-sm overflow-hidden">
      <div class="p-6 md:p-8">
        <div class="flex items-center justify-between mb-4">
          <h3 class="text-sm md:text-base font-black">Riwayat Input (Lokal)</h3>
          <span class="text-[10px] font-black uppercase tracking-widest text-slate-400">Preview</span>
        </div>
        <div class="overflow-x-auto">
          <table class="w-full min-w-[1000px]">
            <thead>
              <tr class="bg-slate-50 border-b text-[10px] font-black text-slate-400 uppercase tracking-widest">
                <th class="p-3 text-left">Barang</th>
                <th class="p-3 text-left">Unit & Tanggal</th>
                <th class="p-3 text-left">Uraian</th>
                <th class="p-3 text-right">Total</th>
                <th class="p-3 text-left">Keterangan</th>
              </tr>
            </thead>
            <tbody id="historyBody" class="divide-y divide-slate-100">
              <tr>
                <td colspan="5" class="p-8 text-center text-slate-500">Belum ada data.</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>

  <script>
    const form = document.getElementById('belanjaUmumForm');
    const volume = document.getElementById('volume');
    const hargaSatuan = document.getElementById('hargaSatuan');
    const totalLabel = document.getElementById('totalLabel');
    const photoInput = document.getElementById('photoInput');
    const photoGrid = document.getElementById('photoGrid');
    const historyBody = document.getElementById('historyBody');

    function formatRupiah(n) {
      return new Intl.NumberFormat('id-ID').format(n || 0);
    }

    function updateTotal() {
      const v = parseFloat(volume.value) || 0;
      const h = parseFloat(hargaSatuan.value) || 0;
      totalLabel.textContent = 'Rp ' + formatRupiah(v * h);
    }

    [volume, hargaSatuan].forEach(i => i.addEventListener('input', updateTotal));
    form.addEventListener('reset', () => setTimeout(updateTotal, 0));

    function renderPhotos(photos) {
      photoGrid.innerHTML = '';
      photos.forEach((src, idx) => {
        const wrap = document.createElement('div');
        wrap.className = 'aspect-square rounded-2xl border-2 border-slate-100 overflow-hidden relative group';
        wrap.innerHTML = `
          <img src="${src}" class="w-full h-full object-cover" alt="Preview" />
          <button type="button" data-idx="${idx}" class="absolute top-2 right-2 bg-rose-500 p-1 rounded-lg text-white opacity-0 group-hover:opacity-100 transition-opacity">&times;</button>
        `;
        photoGrid.appendChild(wrap);
      });
    }

    const photos = [];

    photoGrid.addEventListener('click', (e) => {
      const btn = e.target.closest('button[data-idx]');
      if (!btn) return;
      const idx = parseInt(btn.getAttribute('data-idx'));
      photos.splice(idx, 1);
      renderPhotos(photos);
    });

    photoInput.addEventListener('change', () => {
      const files = Array.from(photoInput.files || []);
      if (photos.length + files.length > 4) {
        alert('Maksimal 4 foto');
        return;
      }
      files.forEach(file => {
        if (!file.type.startsWith('image/')) return;
        const reader = new FileReader();
        reader.onloadend = () => {
          photos.push(reader.result);
          renderPhotos(photos);
        };
        reader.readAsDataURL(file);
      });
      photoInput.value = '';
    });

    form.addEventListener('submit', (e) => {
      e.preventDefault();
      const fd = new FormData(form);
      const data = Object.fromEntries(fd.entries());
      const v = parseFloat(data.volume) || 0;
      const h = parseFloat(data.hargaSatuan) || 0;
      data.nominal = v * h;

      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td class="p-3">
          <div class="flex items-center gap-3">
            <div class="flex -space-x-2">
              ${photos.slice(0,2).map(()=>`<div class='w-10 h-10 rounded-xl bg-slate-100 border-2 border-white overflow-hidden'></div>`).join('') || `<div class='w-10 h-10 rounded-xl bg-slate-100 flex items-center justify-center text-slate-300'>IMG</div>`}
            </div>
            <span class="text-xs font-black text-slate-900 uppercase">${data.namaBarang}</span>
          </div>
        </td>
        <td class="p-3">
          <p class="text-[10px] font-black text-indigo-600 uppercase tracking-tighter">${data.unitKerja}</p>
          <p class="text-[10px] font-bold text-slate-400">${data.tanggalBelanja || '-'}</p>
        </td>
        <td class="p-3 text-sm text-slate-700">${data.uraian}</td>
        <td class="p-3 text-right font-black">Rp ${formatRupiah(data.nominal)}</td>
        <td class="p-3 text-slate-600">${data.keteranganLain || '-'}</td>
      `;
      if (historyBody.children.length === 1) historyBody.innerHTML = '';
      historyBody.prepend(tr);

      // reset state
      photos.splice(0, photos.length);
      renderPhotos(photos);
      form.reset();
      updateTotal();
    });

    updateTotal();
    renderPhotos(photos);
  </script>
</body>
</html>