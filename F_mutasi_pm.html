<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Mutasi PM - SIPANDU</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Plus Jakarta Sans', system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji", "Segoe UI Emoji"; }
  </style>
</head>
<body class="bg-slate-50 text-slate-800">
  <div class="max-w-5xl mx-auto p-6 md:p-10">
    <!-- Header -->
    <div class="mb-6">
      <div class="flex items-center gap-3 mb-2">
        <div class="w-10 h-10 rounded-xl bg-indigo-600 text-white flex items-center justify-center font-black">MP</div>
        <div>
          <h1 class="text-xl md:text-2xl font-black">Mutasi PM</h1>
          <p class="text-[10px] md:text-xs font-black uppercase tracking-widest text-indigo-600">Input dan Riwayat</p>
        </div>
      </div>
      <p class="text-slate-500 text-sm">Form ini mencatat jumlah PM awal, masuk, keluar, dan menghitung sisa akhir.</p>
    </div>

    <!-- Card Form -->
    <div class="bg-white rounded-[2rem] border border-slate-200 shadow-sm overflow-hidden">
      <div class="p-6 md:p-8 space-y-6">
        <h2 class="text-lg md:text-xl font-black text-slate-800">Input Mutasi PM</h2>
        <form id="mutasiFormExternal" class="space-y-6">
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div>
              <label for="unitPelayanan" class="block text-[10px] font-black text-slate-500 uppercase tracking-widest mb-2">Unit Pelayanan</label>
              <select id="unitPelayanan" name="unitPelayanan" class="w-full p-3.5 bg-slate-50 border border-slate-200 rounded-xl outline-none font-bold text-sm focus:border-indigo-500" required>
                <option value="">Pilih Unit</option>
                <option value="PPSDI Raharjo Sragen">PPSDI Raharjo Sragen</option>
                <option value="RPSLU Mojomulyo Sragen">RPSLU Mojomulyo Sragen</option>
                <option value="RPSA Pamardi Siwi Sragen">RPSA Pamardi Siwi Sragen</option>
                <option value="RPS PMKS Gondang">RPS PMKS Gondang</option>
              </select>
            </div>
            <div>
              <label for="bulanTahun" class="block text-[10px] font-black text-slate-500 uppercase tracking-widest mb-2">Periode Laporan</label>
              <input id="bulanTahun" type="month" name="bulanTahun" class="w-full p-3.5 bg-slate-50 border border-slate-200 rounded-xl outline-none font-bold text-sm focus:border-indigo-500" required />
            </div>
          </div>

          <div class="grid grid-cols-2 md:grid-cols-4 gap-4 bg-slate-50 p-6 rounded-3xl border border-slate-100">
            <div>
              <label for="jumlahAwal" class="text-[10px] font-black uppercase tracking-widest text-slate-500 block text-center mb-2">PM Awal</label>
              <input id="jumlahAwal" type="number" name="jumlahAwal" placeholder="0" class="w-full p-3 bg-white border border-slate-200 rounded-xl text-center font-black text-base outline-none focus:border-indigo-500" min="0" required />
            </div>
            <div>
              <label for="pmMasuk" class="text-[10px] font-black uppercase tracking-widest text-emerald-600 block text-center mb-2">Masuk</label>
              <input id="pmMasuk" type="number" name="pmMasuk" placeholder="0" class="w-full p-3 bg-white border border-emerald-200 rounded-xl text-center font-black text-base outline-none focus:border-emerald-500" min="0" required />
            </div>
            <div>
              <label for="pmKeluar" class="text-[10px] font-black uppercase tracking-widest text-rose-600 block text-center mb-2">Keluar</label>
              <input id="pmKeluar" type="number" name="pmKeluar" placeholder="0" class="w-full p-3 bg-white border border-rose-200 rounded-xl text-center font-black text-base outline-none focus:border-rose-500" min="0" required />
            </div>
            <div>
              <label class="text-[10px] font-black uppercase tracking-widest text-slate-900 block text-center mb-2">Sisa Akhir</label>
              <input id="jumlahAkhir" type="number" name="jumlahAkhir" class="w-full p-3 bg-slate-900 text-white rounded-xl text-center font-black text-base shadow" readonly />
            </div>
          </div>

          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div>
              <label for="pdfFile" class="block text-[10px] font-black text-slate-500 uppercase tracking-widest mb-2">Upload PDF (Opsional)</label>
              <input id="pdfFile" type="file" name="pdfFile" accept="application/pdf,.pdf" class="block w-full text-sm text-slate-600 file:mr-4 file:py-2.5 file:px-4 file:rounded-lg file:border-0 file:text-xs file:font-black file:bg-indigo-50 file:text-indigo-700 hover:file:bg-indigo-100" />
              <p id="pdfInfo" class="text-[10px] text-slate-400 font-bold mt-1">Maks 5MB</p>
            </div>
            <div>
              <label for="catatan" class="block text-[10px] font-black text-slate-500 uppercase tracking-widest mb-2">Catatan</label>
              <input id="catatan" name="catatan" placeholder="Tambahkan catatan jika diperlukan" class="w-full p-3.5 bg-slate-50 border border-slate-200 rounded-xl font-bold text-sm outline-none focus:border-indigo-500" />
            </div>
          </div>

          <div class="flex gap-3 pt-2">
            <button type="reset" class="px-5 py-3 bg-slate-100 text-slate-600 rounded-xl font-black text-[10px] uppercase hover:bg-slate-200">Reset</button>
            <button type="submit" class="px-6 py-3 bg-indigo-600 text-white rounded-xl font-black text-[10px] uppercase tracking-widest hover:bg-indigo-700">Simpan</button>
          </div>
        </form>
      </div>
    </div>

    <!-- Riwayat (dummy lokal) -->
    <div class="mt-6 bg-white rounded-3xl border border-slate-200 shadow-sm overflow-hidden">
      <div class="p-6 md:p-8">
        <div class="flex items-center justify-between mb-4">
          <h3 class="text-sm md:text-base font-black">Riwayat Input (Lokal)</h3>
          <span class="text-[10px] font-black uppercase tracking-widest text-slate-400">Preview</span>
        </div>
        <div class="overflow-x-auto">
          <table class="w-full min-w-[880px]">
            <thead>
              <tr class="bg-slate-50 border-b text-[10px] font-black text-slate-400 uppercase tracking-widest">
                <th class="p-3 text-left">Unit</th>
                <th class="p-3 text-center">Periode</th>
                <th class="p-3 text-center">Awal</th>
                <th class="p-3 text-center">Masuk</th>
                <th class="p-3 text-center">Keluar</th>
                <th class="p-3 text-center">Sisa</th>
                <th class="p-3 text-left">Catatan</th>
                <th class="p-3 text-center">PDF</th>
              </tr>
            </thead>
            <tbody id="historyBody" class="divide-y divide-slate-100">
              <tr>
                <td colspan="8" class="p-8 text-center text-slate-500">Belum ada data.</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>

  <script>
    const form = document.getElementById('mutasiFormExternal');
    const jumlahAwal = document.getElementById('jumlahAwal');
    const pmMasuk = document.getElementById('pmMasuk');
    const pmKeluar = document.getElementById('pmKeluar');
    const jumlahAkhir = document.getElementById('jumlahAkhir');
    const pdfEl = document.getElementById('pdfFile');
    const pdfInfo = document.getElementById('pdfInfo');
    const historyBody = document.getElementById('historyBody');

    function hitungAkhir() {
      const a = parseInt(jumlahAwal.value) || 0;
      const m = parseInt(pmMasuk.value) || 0;
      const k = parseInt(pmKeluar.value) || 0;
      jumlahAkhir.value = (a + m) - k;
    }

    [jumlahAwal, pmMasuk, pmKeluar].forEach(i => i.addEventListener('input', hitungAkhir));
    form.addEventListener('reset', () => setTimeout(hitungAkhir, 0));

    pdfEl.addEventListener('change', () => {
      const f = pdfEl.files && pdfEl.files[0];
      if (!f) { pdfInfo.textContent = 'Maks 5MB'; return; }
      if (f.type !== 'application/pdf') { pdfInfo.textContent = 'File harus PDF'; pdfEl.value=''; return; }
      if (f.size > 5 * 1024 * 1024) { pdfInfo.textContent = 'Ukuran PDF > 5MB'; pdfEl.value=''; return; }
      pdfInfo.textContent = 'PDF: ' + f.name;
    });

    form.addEventListener('submit', (e) => {
      e.preventDefault();
      const fd = new FormData(form);
      const data = Object.fromEntries(fd.entries());
      data.jumlahAwal = Number(data.jumlahAwal)||0;
      data.pmMasuk = Number(data.pmMasuk)||0;
      data.pmKeluar = Number(data.pmKeluar)||0;
      data.jumlahAkhir = (data.jumlahAwal + data.pmMasuk) - data.pmKeluar;
      const f = pdfEl.files && pdfEl.files[0];
      data.pdfName = f ? f.name : '';

      // Simpan ke riwayat lokal (demo)
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td class="p-3 font-bold text-slate-700">${data.unitPelayanan}</td>
        <td class="p-3 text-center text-slate-600 text-sm">${data.bulanTahun}</td>
        <td class="p-3 text-center">${data.jumlahAwal}</td>
        <td class="p-3 text-center text-emerald-600 font-bold">+${data.pmMasuk}</td>
        <td class="p-3 text-center text-rose-600 font-bold">-${data.pmKeluar}</td>
        <td class="p-3 text-center font-black">${data.jumlahAkhir}</td>
        <td class="p-3 text-slate-600">${data.catatan || '-'}</td>
        <td class="p-3 text-center text-xs">${data.pdfName || '-'}</td>
      `;
      if (historyBody.children.length === 1) historyBody.innerHTML = '';
      historyBody.prepend(tr);

      form.reset();
      hitungAkhir();
    });

    hitungAkhir();
  </script>
</body>
</html>